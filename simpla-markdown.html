<link rel="import" href="../polymer/polymer.html"> <dom-module id="simpla-markdown"> <template> <style>:host{display:block;position:relative}.content[data-editing]{opacity:0;-webkit-transition:opacity 150ms ease;transition:opacity 150ms ease}.content__shade{position:absolute;top:0;right:0;bottom:0;left:0;background:var(--simpla-light-black);border-radius:var(--simpla-border-radius);cursor:pointer;z-index:1;opacity:0;-webkit-transition:opacity .2s ease;transition:opacity .2s ease}.content__shade:hover{opacity:1}.content__placeholder{display:inline-block;padding:.3em;opacity:.45}.content:hover .content__placeholder{opacity:.65}[hidden]{display:none!important}</style> <simpla-markdown-editor html="{{value}}" active="{{active}}"> </simpla-markdown-editor> <div class="content" data-editing$="[[active]]"> <template is="dom-if" if="[[editable]]"> <div class="content__shade" hidden$="[[active]]" on-tap="_goActive"> </div> <span class="content__placeholder" hidden$="[[_hasContent(value)]]"> [[placeholder]] </span> </template> <slot></slot> </div> </template> <script>!function(){"use strict";var e={properties:{path:{type:String,observer:"_initPath"},_simplaObservers:{type:Object,readonly:!0,value:function(){return{}}}},observers:["_updateBuffer(value)"],attached:function(){this._checkSimpla(),this._observeEditable()},detached:function(){var e=this;Object.keys(this._simplaObservers).forEach(function(t){e._simplaObservers[t].unobserve()}),this._simplaObservers=[]},_checkSimpla:function(){return window.Simpla?window.Simpla.getState("config").project?void 0:(console.error("You must initialise a Simpla project before using simpla-markdown"),!1):(console.error("Cannot find Simpla global"),!1)},_initPath:function(e){var t=this;e&&(this._observeBuffer(e),Simpla.get(e).then(function(e){return t._setValue(e)}))},_observeBuffer:function(e){var t=this,i=this._simplaObservers;i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,function(e){return t._setValue(e)})},_updateBuffer:function(e){if(this.path)return Simpla.set(this.path,{type:"Article",data:{html:e}})},_observeEditable:function(){var e=this,t=this._simplaObservers;this.editable=Simpla.getState("editable"),t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){return e.editable=t})},_setValue:function(e){e.path===this.path&&(this.value=e.data.html||"")}};Polymer({is:"simpla-markdown",properties:{value:{type:String,value:""},editable:{type:Boolean,reflectToAttribute:!0,notify:!0},active:{type:Boolean,value:!1,notify:!0},placeholder:{type:String,value:"Tap to start writing..."}},observers:["_render(value, active)","_importEditor(editable)","_ensureInactiveWhenNotEditable(editable)"],behaviors:[e],_importEditor:function(e){this.importHref(this.resolveUrl("simpla-markdown-editor.html"))},_render:function(e,t){t||(Polymer.dom(this).innerHTML=e,this.fire("render"))},_ensureInactiveWhenNotEditable:function(e){e||(this.active=!1)},_goActive:function(){this.active=!0},_hasContent:function(e){return!!e.trim()}})}()</script> </dom-module> 